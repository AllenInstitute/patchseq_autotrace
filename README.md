# patchseq-autotrace
This package supports the patchseq autotrace pipeline to generate automated neuron morphological reconstructions.


Installation instructions
=========================

    conda create -n autotrace_env python=3.9   
    conda activate autotrace_env  
    git clone https://github.com/AllenInstitute/patchseq_autotrace.git  
    cd patchseq_autotrace  
    pip install -r requirements.txt  
    pip install .

Internal Allen Institute Use
============================
In order to download image stacks from the internal LIMS system, you must set certain OS environment variables to connect properly.  These include

    LIMS_HOST
    LIMS_DBNAME
    LIMS_USER
    LIMS_PASSWORD

To set these either open a terminal and run the following commands or add the commands to your .bashrc file.

    export LIMS_HOST=yourdbhostname 

Contact the technology team if you need to get credential details to access LIMS.


Scripts
=======
After installation the following console scripts will be available to run from the command line of your environment. To see detailed instructions on each script type the name of the SCRIPT_NAME --help

auto-patchseq-pipeline-hpc
====================
script to submit a batch of cells to run on the allen hpc. Creates a DAG workflow composed of the following scripts

auto-pre-proc
----------------------------
script to prepare an already existing image stack, or obtain from LIMS and prepare an image stack for segmentation

auto-segmentation
--------------------------------
script to segment the resulting images from **auto-pre-proc**

auto-post-proc
----------------------------
script to post-process and skeletonize the segmented image stack generated by **auto-segmentation**

auto-skeleton-to-swc
------------------------------
script to convert the skeletonized image generated in **auto-post-proc** to an swc file

auto-cleanup
====================
script is run at the end of the pipeline (after **auto-skeleton-to-swc**), or if any of the intermediate steps fail to remove large files from disk.



Statement of Support
====================
This code is an important part of the internal Allen Institute code base and we are actively using and maintaining it. Issues are encouraged, but because this tool is so central to our mission pull requests might not be accepted if they conflict with our existing plans.